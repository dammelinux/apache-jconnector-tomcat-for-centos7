#!/bin/sh
yum update -y \
&& yum install wget openssh-server httpd-devel apr apr-devel apr-util apr-util-devel gcc* gcc-c++ make autoconf libtool python-setuptools easy_install supervisor java-11-openjdk java-11-openjdk-devel  -y \
&& echo "Finished" \
&& cp /source/tomcat-connectors-1.2.46-src.tar.gz /opt/ \
&& cd /opt/ \
&& tar -zxvf tomcat-connectors-1.2.46-src.tar.gz \
&& cd /opt/tomcat-connectors-1.2.46-src/native \
&& echo "###################################################### build file ################################################" \
&& ./configure --with-apxs=/usr/bin/apxs \
&& make \
&& echo "###################################################### make ################################################" \
&& make install \
&& echo "###################################################### make install ################################################" \
&& echo "###################################################### Java Installed ######################################################"


mv /etc/httpd/conf/httpd.conf /etc/httpd/conf/httpd.conf_bk \
&& cp /source/http/conf/httpd.conf /etc/httpd/conf/ \
&& cp /source/http/conf/httpd-vhost.conf /etc/httpd/conf/ \
&& cp /source/http/conf/workers_jk.properties /etc/httpd/conf/ \
&& cp /source/http/conf.d/mod_jk.conf /etc/httpd/conf.d/ \
&& echo "###################################################### Copied file ######################################################"

mkdir -p /home/application_data \
&& cp -Rf /application_data/* /home/application_data/ \
&& echo "###################################################### Copied file ######################################################"


systemctl start httpd
echo "###################################################### start Apache ######################################################" \
echo "###################################################### start Apache ######################################################" \
echo "###################################################### start Apache ######################################################" \
echo "###################################################### start Apache ######################################################" \
echo "###################################################### start Apache ######################################################"



cd /source \
&& cp /source/apache-tomcat-9.0.30.tar.gz /opt/ \
&& cd /opt/ \
&& tar -zxvf apache-tomcat-9.0.30.tar.gz \
&& mkdir /opt/tomcat9 \
&& cd apache-tomcat-9.0.30 \
&& cp -R * /opt/tomcat9/ \
&& chmod -R 777 /opt/tomcat9 \
&& cd / \
&& cp -Rf server.xml /opt/tomcat9/conf/ \
&& cd /opt/tomcat9/bin \
&& ./startup.sh \
&& echo "###################################################### start Tomcat 9 ######################################################" \
&& echo "###################################################### start Tomcat 9 ######################################################" \
&& echo "###################################################### start Tomcat 9 ######################################################" \
&& echo "###################################################### start Tomcat 9 ######################################################" \
&& echo "###################################################### start Tomcat 9 ######################################################" \
&& echo "###################################################### start Tomcat 9 ######################################################" \
&& echo "###################################################### start Tomcat 9 ######################################################"


firewall-cmd --add-port=80/tcp --permanent
firewall-cmd --add-port=8080/tcp --permanent
firewall-cmd --reload
firewall-cmd --list-port
echo "###################################################### Open port 80 - 8080  ######################################################" \
&& echo "###################################################### Open port 80 - 8080 ######################################################" \
&& echo "###################################################### Open port 80 - 8080 ######################################################" \
&& echo "###################################################### Open port 80 - 8080 ######################################################" \
&& echo "###################################################### Open port 80 - 8080 ######################################################"

rm -rf /opt/apache-tomcat-9.0.30/ \
&& rm -rf /opt/apache-tomcat-9.0.30.tar.gz \
&& rm -rf /opt/tomcat-connectors-1.2.46-src.tar.gz \
&& rm -rf /source \
echo "###################################################### Remove Cache  ######################################################" \
&& echo "###################################################### Remove Cache  ######################################################" \
&& echo "###################################################### Remove Cache  ######################################################" \
&& echo "###################################################### Remove Cache ######################################################" \
&& echo "###################################################### Remove Cache ######################################################"


